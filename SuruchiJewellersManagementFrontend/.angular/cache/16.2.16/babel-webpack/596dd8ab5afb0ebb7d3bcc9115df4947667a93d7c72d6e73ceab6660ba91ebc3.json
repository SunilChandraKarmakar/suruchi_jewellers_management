{"ast":null,"code":"import { __decorate, __metadata } from 'tslib';\nimport { ESCAPE, hasModifierKey } from '@angular/cdk/keycodes';\nimport { Overlay, OverlayModule, ConnectionPositionPair } from '@angular/cdk/overlay';\nimport { Platform, PlatformModule } from '@angular/cdk/platform';\nimport { TemplatePortal } from '@angular/cdk/portal';\nimport { EventEmitter, Directive, ElementRef, Renderer2, ViewContainerRef, Input, Output, NgModule, Host, Optional, Component, ViewEncapsulation, ChangeDetectionStrategy, ChangeDetectorRef, ViewChild, TemplateRef, ɵɵdefineInjectable, ɵɵinject, Injectable } from '@angular/core';\nimport { warnDeprecation } from 'ng-zorro-antd/core/logger';\nimport { POSITION_MAP, NzOverlayModule } from 'ng-zorro-antd/core/overlay';\nimport { InputBoolean } from 'ng-zorro-antd/core/util';\nimport { Subject, BehaviorSubject, merge, fromEvent, EMPTY, combineLatest, Subscription } from 'rxjs';\nimport { mapTo, map, switchMap, filter, auditTime, distinctUntilChanged, takeUntil, take } from 'rxjs/operators';\nimport { Directionality, BidiModule } from '@angular/cdk/bidi';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { NzButtonGroupComponent, NzButtonModule } from 'ng-zorro-antd/button';\nimport { NzNoAnimationDirective, NzNoAnimationModule } from 'ng-zorro-antd/core/no-animation';\nimport { NzOutletModule } from 'ng-zorro-antd/core/outlet';\nimport { NzIconModule } from 'ng-zorro-antd/icon';\nimport { MenuService, NzIsMenuInsideDropDownToken, NzMenuModule } from 'ng-zorro-antd/menu';\nimport { slideMotion } from 'ng-zorro-antd/core/animation';\n\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\nconst listOfPositions = [POSITION_MAP.bottomLeft, POSITION_MAP.bottomRight, POSITION_MAP.topRight, POSITION_MAP.topLeft];\nlet NzDropDownDirective = /*#__PURE__*/(() => {\n  class NzDropDownDirective {\n    constructor(elementRef, overlay, renderer, viewContainerRef, platform) {\n      this.elementRef = elementRef;\n      this.overlay = overlay;\n      this.renderer = renderer;\n      this.viewContainerRef = viewContainerRef;\n      this.platform = platform;\n      this.overlayRef = null;\n      this.destroy$ = new Subject();\n      this.positionStrategy = this.overlay.position().flexibleConnectedTo(this.elementRef.nativeElement).withLockedPosition().withTransformOriginOn('.ant-dropdown');\n      this.inputVisible$ = new BehaviorSubject(false);\n      this.nzTrigger$ = new BehaviorSubject('hover');\n      this.overlayClose$ = new Subject();\n      this.nzDropdownMenu = null;\n      this.nzTrigger = 'hover';\n      this.nzMatchWidthElement = null;\n      /**\n       * @deprecated Not supported, use `nzHasBackDrop` instead.\n       * @breaking-change 12.0.0\n       */\n      this.nzBackdrop = false;\n      this.nzHasBackdrop = false;\n      this.nzClickHide = true;\n      this.nzDisabled = false;\n      this.nzVisible = false;\n      this.nzOverlayClassName = '';\n      this.nzOverlayStyle = {};\n      this.nzPlacement = 'bottomLeft';\n      this.nzVisibleChange = new EventEmitter();\n      // TODO: move to host after View Engine deprecation\n      this.elementRef.nativeElement.classList.add('ant-dropdown-trigger');\n    }\n    setDropdownMenuValue(key, value) {\n      if (this.nzDropdownMenu) {\n        this.nzDropdownMenu.setValue(key, value);\n      }\n    }\n    ngOnInit() {}\n    ngAfterViewInit() {\n      if (this.nzDropdownMenu) {\n        const nativeElement = this.elementRef.nativeElement;\n        /** host mouse state **/\n        const hostMouseState$ = merge(fromEvent(nativeElement, 'mouseenter').pipe(mapTo(true)), fromEvent(nativeElement, 'mouseleave').pipe(mapTo(false)));\n        /** menu mouse state **/\n        const menuMouseState$ = this.nzDropdownMenu.mouseState$;\n        /** merged mouse state **/\n        const mergedMouseState$ = merge(menuMouseState$, hostMouseState$);\n        /** host click state **/\n        const hostClickState$ = fromEvent(nativeElement, 'click').pipe(map(() => !this.nzVisible));\n        /** visible state switch by nzTrigger **/\n        const visibleStateByTrigger$ = this.nzTrigger$.pipe(switchMap(trigger => {\n          if (trigger === 'hover') {\n            return mergedMouseState$;\n          } else if (trigger === 'click') {\n            return hostClickState$;\n          } else {\n            return EMPTY;\n          }\n        }));\n        const descendantMenuItemClick$ = this.nzDropdownMenu.descendantMenuItemClick$.pipe(filter(() => this.nzClickHide), mapTo(false));\n        const domTriggerVisible$ = merge(visibleStateByTrigger$, descendantMenuItemClick$, this.overlayClose$).pipe(filter(() => !this.nzDisabled));\n        const visible$ = merge(this.inputVisible$, domTriggerVisible$);\n        combineLatest([visible$, this.nzDropdownMenu.isChildSubMenuOpen$]).pipe(map(([visible, sub]) => visible || sub), auditTime(150), distinctUntilChanged(), filter(() => this.platform.isBrowser), takeUntil(this.destroy$)).subscribe(visible => {\n          const element = this.nzMatchWidthElement ? this.nzMatchWidthElement.nativeElement : nativeElement;\n          const triggerWidth = element.getBoundingClientRect().width;\n          if (this.nzVisible !== visible) {\n            this.nzVisibleChange.emit(visible);\n          }\n          this.nzVisible = visible;\n          if (visible) {\n            /** set up overlayRef **/\n            if (!this.overlayRef) {\n              /** new overlay **/\n              this.overlayRef = this.overlay.create({\n                positionStrategy: this.positionStrategy,\n                minWidth: triggerWidth,\n                disposeOnNavigation: true,\n                hasBackdrop: (this.nzHasBackdrop || this.nzBackdrop) && this.nzTrigger === 'click',\n                scrollStrategy: this.overlay.scrollStrategies.reposition()\n              });\n              merge(this.overlayRef.backdropClick(), this.overlayRef.detachments(), this.overlayRef.outsidePointerEvents().pipe(filter(e => !this.elementRef.nativeElement.contains(e.target))), this.overlayRef.keydownEvents().pipe(filter(e => e.keyCode === ESCAPE && !hasModifierKey(e)))).pipe(takeUntil(this.destroy$)).subscribe(() => {\n                this.overlayClose$.next(false);\n              });\n            } else {\n              /** update overlay config **/\n              const overlayConfig = this.overlayRef.getConfig();\n              overlayConfig.minWidth = triggerWidth;\n            }\n            /** open dropdown with animation **/\n            this.positionStrategy.withPositions([POSITION_MAP[this.nzPlacement], ...listOfPositions]);\n            /** reset portal if needed **/\n            if (!this.portal || this.portal.templateRef !== this.nzDropdownMenu.templateRef) {\n              this.portal = new TemplatePortal(this.nzDropdownMenu.templateRef, this.viewContainerRef);\n            }\n            this.overlayRef.attach(this.portal);\n          } else {\n            /** detach overlayRef if needed **/\n            if (this.overlayRef) {\n              this.overlayRef.detach();\n            }\n          }\n        });\n        this.nzDropdownMenu.animationStateChange$.pipe(takeUntil(this.destroy$)).subscribe(event => {\n          if (event.toState === 'void') {\n            if (this.overlayRef) {\n              this.overlayRef.dispose();\n            }\n            this.overlayRef = null;\n          }\n        });\n      }\n    }\n    ngOnDestroy() {\n      this.destroy$.next();\n      this.destroy$.complete();\n      if (this.overlayRef) {\n        this.overlayRef.dispose();\n        this.overlayRef = null;\n      }\n    }\n    ngOnChanges(changes) {\n      const {\n        nzVisible,\n        nzDisabled,\n        nzOverlayClassName,\n        nzOverlayStyle,\n        nzTrigger,\n        nzBackdrop\n      } = changes;\n      if (nzTrigger) {\n        this.nzTrigger$.next(this.nzTrigger);\n      }\n      if (nzVisible) {\n        this.inputVisible$.next(this.nzVisible);\n      }\n      if (nzDisabled) {\n        const nativeElement = this.elementRef.nativeElement;\n        if (this.nzDisabled) {\n          this.renderer.setAttribute(nativeElement, 'disabled', '');\n          this.inputVisible$.next(false);\n        } else {\n          this.renderer.removeAttribute(nativeElement, 'disabled');\n        }\n      }\n      if (nzOverlayClassName) {\n        this.setDropdownMenuValue('nzOverlayClassName', this.nzOverlayClassName);\n      }\n      if (nzOverlayStyle) {\n        this.setDropdownMenuValue('nzOverlayStyle', this.nzOverlayStyle);\n      }\n      if (nzBackdrop) {\n        warnDeprecation('`nzBackdrop` in dropdown component will be removed in 12.0.0, please use `nzHasBackdrop` instead.');\n      }\n    }\n  }\n  __decorate([InputBoolean(), __metadata(\"design:type\", Object)], NzDropDownDirective.prototype, \"nzBackdrop\", void 0);\n  __decorate([InputBoolean(), __metadata(\"design:type\", Object)], NzDropDownDirective.prototype, \"nzHasBackdrop\", void 0);\n  __decorate([InputBoolean(), __metadata(\"design:type\", Object)], NzDropDownDirective.prototype, \"nzClickHide\", void 0);\n  __decorate([InputBoolean(), __metadata(\"design:type\", Object)], NzDropDownDirective.prototype, \"nzDisabled\", void 0);\n  __decorate([InputBoolean(), __metadata(\"design:type\", Object)], NzDropDownDirective.prototype, \"nzVisible\", void 0);\n\n  /**\n   * Use of this source code is governed by an MIT-style license that can be\n   * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n   */\n  return NzDropDownDirective;\n})();\nclass NzContextMenuServiceModule {}\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\nclass NzDropDownADirective {\n  constructor(elementRef) {\n    this.elementRef = elementRef;\n    // TODO: move to host after View Engine deprecation\n    this.elementRef.nativeElement.classList.add('ant-dropdown-link');\n  }\n}\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\nclass NzDropdownButtonDirective {\n  constructor(renderer, nzButtonGroupComponent, elementRef) {\n    this.renderer = renderer;\n    this.nzButtonGroupComponent = nzButtonGroupComponent;\n    this.elementRef = elementRef;\n  }\n  ngAfterViewInit() {\n    const parentElement = this.renderer.parentNode(this.elementRef.nativeElement);\n    if (this.nzButtonGroupComponent && parentElement) {\n      this.renderer.addClass(parentElement, 'ant-dropdown-button');\n    }\n  }\n}\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\nclass NzDropdownMenuComponent {\n  constructor(cdr, elementRef, renderer, viewContainerRef, nzMenuService, directionality, noAnimation) {\n    this.cdr = cdr;\n    this.elementRef = elementRef;\n    this.renderer = renderer;\n    this.viewContainerRef = viewContainerRef;\n    this.nzMenuService = nzMenuService;\n    this.directionality = directionality;\n    this.noAnimation = noAnimation;\n    this.mouseState$ = new BehaviorSubject(false);\n    this.isChildSubMenuOpen$ = this.nzMenuService.isChildSubMenuOpen$;\n    this.descendantMenuItemClick$ = this.nzMenuService.descendantMenuItemClick$;\n    this.animationStateChange$ = new EventEmitter();\n    this.nzOverlayClassName = '';\n    this.nzOverlayStyle = {};\n    this.dir = 'ltr';\n    this.destroy$ = new Subject();\n  }\n  onAnimationEvent(event) {\n    this.animationStateChange$.emit(event);\n  }\n  setMouseState(visible) {\n    this.mouseState$.next(visible);\n  }\n  setValue(key, value) {\n    this[key] = value;\n    this.cdr.markForCheck();\n  }\n  ngOnInit() {\n    var _a;\n    (_a = this.directionality.change) === null || _a === void 0 ? void 0 : _a.pipe(takeUntil(this.destroy$)).subscribe(direction => {\n      this.dir = direction;\n      this.cdr.detectChanges();\n    });\n    this.dir = this.directionality.value;\n  }\n  ngAfterContentInit() {\n    this.renderer.removeChild(this.renderer.parentNode(this.elementRef.nativeElement), this.elementRef.nativeElement);\n  }\n  ngOnDestroy() {\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n}\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\nclass NzDropDownModule {}\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\nconst listOfPositions$1 = [new ConnectionPositionPair({\n  originX: 'start',\n  originY: 'top'\n}, {\n  overlayX: 'start',\n  overlayY: 'top'\n}), new ConnectionPositionPair({\n  originX: 'start',\n  originY: 'top'\n}, {\n  overlayX: 'start',\n  overlayY: 'bottom'\n}), new ConnectionPositionPair({\n  originX: 'start',\n  originY: 'top'\n}, {\n  overlayX: 'end',\n  overlayY: 'bottom'\n}), new ConnectionPositionPair({\n  originX: 'start',\n  originY: 'top'\n}, {\n  overlayX: 'end',\n  overlayY: 'top'\n})];\nlet NzContextMenuService = /*#__PURE__*/(() => {\n  class NzContextMenuService {\n    constructor(overlay) {\n      this.overlay = overlay;\n      this.overlayRef = null;\n      this.closeSubscription = Subscription.EMPTY;\n    }\n    create($event, nzDropdownMenuComponent) {\n      this.close(true);\n      const {\n        x,\n        y\n      } = $event;\n      if ($event instanceof MouseEvent) {\n        $event.preventDefault();\n      }\n      const positionStrategy = this.overlay.position().flexibleConnectedTo({\n        x,\n        y\n      }).withPositions(listOfPositions$1).withTransformOriginOn('.ant-dropdown');\n      this.overlayRef = this.overlay.create({\n        positionStrategy,\n        disposeOnNavigation: true,\n        scrollStrategy: this.overlay.scrollStrategies.close()\n      });\n      this.closeSubscription = merge(nzDropdownMenuComponent.descendantMenuItemClick$, fromEvent(document, 'click').pipe(filter(event => !!this.overlayRef && !this.overlayRef.overlayElement.contains(event.target)), /** handle firefox contextmenu event **/\n      filter(event => event.button !== 2), take(1))).subscribe(() => {\n        this.close();\n      });\n      this.overlayRef.attach(new TemplatePortal(nzDropdownMenuComponent.templateRef, nzDropdownMenuComponent.viewContainerRef));\n    }\n    close(clear = false) {\n      if (this.overlayRef) {\n        this.overlayRef.detach();\n        if (clear) {\n          this.overlayRef.dispose();\n        }\n        this.overlayRef = null;\n        this.closeSubscription.unsubscribe();\n      }\n    }\n  }\n  NzContextMenuService.ɵprov = ɵɵdefineInjectable({\n    factory: function NzContextMenuService_Factory() {\n      return new NzContextMenuService(ɵɵinject(Overlay));\n    },\n    token: NzContextMenuService,\n    providedIn: NzContextMenuServiceModule\n  });\n  return NzContextMenuService;\n})();\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { NzContextMenuService, NzContextMenuServiceModule, NzDropDownADirective, NzDropDownDirective, NzDropDownModule, NzDropdownButtonDirective, NzDropdownMenuComponent };\n//# sourceMappingURL=ng-zorro-antd-dropdown.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}